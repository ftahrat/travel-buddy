<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Travel Connections</title>
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(to right, #ffe6f0, #e6f7ff);
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #ff3366;
      margin-bottom: 20px;
    }
    form, .match-section {
      background-color: #ffffffcc;
      padding: 25px;
      border-radius: 15px;
      display: inline-block;
      margin-bottom: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    input, select, button {
      display: block;
      margin: 12px auto;
      padding: 12px;
      width: 80%;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: linear-gradient(to right, #ff6699, #ff3366);
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    #matches {
      margin-top: 20px;
      font-weight: bold;
      color: #333;
      word-break: break-word;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
      background-color: #fff3f6;
      border-radius: 10px;
      text-align: left;
    }
    #matches li {
      margin: 12px 0;
      padding: 10px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<h1>Student Travel Connections</h1>

<form id="travelForm">
  <input type="text" id="name" placeholder="Your Name" required>
  <input type="email" id="email" placeholder="Your Email" required>

  <label for="destination">Choose your destination:</label>
  <select id="destination" required>
    <option value="">--Select a destination--</option>
    <option>Austria</option>
    <option>Belgium</option>
    <option>Croatia</option>
    <option>Cyprus</option>
    <option>Czech Republic</option>
    <option>Denmark</option>
    <option>Finland</option>
    <option>France</option>
    <option>Germany</option>
    <option>Greece</option>
    <option>Iceland</option>
    <option>Ireland</option>
    <option>Italy</option>
    <option>Luxembourg</option>
    <option>Montenegro</option>
    <option>Malta</option>
    <option>Albania</option>
    <option>Netherlands</option>
    <option>Norway</option>
    <option>Poland</option>
    <option>Portugal</option>
    <option>Romania</option>
    <option>Serbia</option>
    <option>Spain</option>
    <option>Sweden</option>
    <option>Switzerland</option>
    <option>Turkey</option>
    <option>Georgia</option>
    <option>London</option>
  </select>

  <select id="londonTrips" style="display:none;">
    <option value="">--Select a day trip--</option>
    <option>Stonehenge</option>
    <option>Cambridge</option>
    <option>Oxford</option>
    <option>Bath</option>
    <option>Brighton</option>
    <option>Windsor</option>
  </select>

  <button type="submit">Join Travel Pool</button>
</form>

<div class="match-section">
  <label for="matchDestination">Select destination to see groups:</label>
  <select id="matchDestination">
    <option value="">--Select a destination--</option>
    <option>Austria</option>
    <option>Belgium</option>
    <option>Croatia</option>
    <option>Cyprus</option>
    <option>Czech Republic</option>
    <option>Denmark</option>
    <option>Finland</option>
    <option>France</option>
    <option>Germany</option>
    <option>Greece</option>
    <option>Iceland</option>
    <option>Ireland</option>
    <option>Italy</option>
    <option>Luxembourg</option>
    <option>Montenegro</option>
    <option>Malta</option>
    <option>Albania</option>
    <option>Netherlands</option>
    <option>Norway</option>
    <option>Poland</option>
    <option>Portugal</option>
    <option>Romania</option>
    <option>Serbia</option>
    <option>Spain</option>
    <option>Sweden</option>
    <option>Switzerland</option>
    <option>Turkey</option>
    <option>Georgia</option>
    <option>London</option>
  </select>
  <button id="showBtn">Show Groups</button>
</div>

<ul id="matches"></ul>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbyDtNo5Xabl3O_OlFsA7goVl5pSqozFwMBNZoxj_YMuCC1IV5waFIbvgAsPfGPlih9F/exec'; // <-- replace with your deployed web app URL

  // Handle form submission
  document.getElementById('travelForm').addEventListener('submit', function(e){
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const destination = document.getElementById('destination').value.trim();
    const dayTrip = document.getElementById('londonTrips').value.trim();

    const formData = new FormData();
    formData.append('name', name);
    formData.append('email', email);
    formData.append('destination', destination);
    formData.append('dayTrip', dayTrip);

    fetch(scriptURL, { method: 'POST', body: formData })
      .then(() => {
        alert("You have joined the travel pool!");
        document.getElementById('travelForm').reset();
        document.getElementById('londonTrips').style.display = 'none';
      })
      .catch(error => {
        console.error('Error!', error.message);
        alert("There was an error submitting the form.");
      });
  });

  // Show London trips only when London is chosen
  document.getElementById('destination').addEventListener('change', function() {
    document.getElementById('londonTrips').style.display = this.value === 'London' ? 'block' : 'none';
  });

  // Show groups by destination
  document.getElementById('showBtn').addEventListener('click', function() {
    const selectedDestination = document.getElementById('matchDestination').value;

    let url = scriptURL;
    if (selectedDestination) {
      url += `?destination=${encodeURIComponent(selectedDestination)}`;
    }

    fetch(url)
      .then(response => response.json())
      .then(groups => {
        const matchesList = document.getElementById('matches');
        matchesList.innerHTML = "";

        const groupKeys = Object.keys(groups);
        if (groupKeys.length === 0) {
          matchesList.innerHTML = `<li>No groups found${selectedDestination ? ' for ' + selectedDestination : ''}</li>`;
        } else {
          groupKeys.forEach(groupName => {
            const group = groups[groupName];
            const li = document.createElement('li');
            li.innerHTML = `<strong>${groupName}</strong> (${group.length} students)<br>` +
              group.map(s => `${s.name} (${s.email})`).join("<br>");
            matchesList.appendChild(li);
          });
        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        alert("Could not load student groups.");
      });
  });
</script>

</body>
</html>
