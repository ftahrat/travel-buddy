<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Travel Connections</title>
<style>
body {
  font-family: 'Poppins', Arial, sans-serif;
  background: linear-gradient(to right, #ffe6f0, #e6f7ff);
  text-align: center;
  padding: 20px;
}
h1 { color: #ff3366; margin-bottom: 20px; }
form, .match-section {
  background-color: #ffffffcc;
  padding: 25px;
  border-radius: 15px;
  display: inline-block;
  margin-bottom: 20px;
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}
input, select, button {
  display: block;
  margin: 12px auto;
  padding: 12px;
  width: 80%;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
}
button {
  background: linear-gradient(to right, #ff6699, #ff3366);
  color: white;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
}
button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
#matches {
  margin-top: 20px;
  font-weight: bold;
  color: #333;
  word-break: break-word;
  max-height: 500px;
  overflow-y: auto;
  padding: 10px;
  background-color: #fff3f6;
  border-radius: 10px;
  text-align: left;
}
#matches li { margin: 8px 0; }
.group-box {
  margin: 15px 0;
  padding: 10px;
  border-radius: 10px;
  background: #fefefe;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.group-box h3 { margin: 5px 0; color: #ff3366; }
.group-box a {
  display: inline-block;
  margin-bottom: 8px;
  color: #0073e6;
  text-decoration: underline;
}
</style>
</head>
<body>

<h1>Student Travel Connections</h1>

<form id="travelForm">
  <input type="text" id="name" placeholder="Your Name" required>
  <input type="email" id="email" placeholder="Your Email">

  <label for="destination">Destination:</label>
  <select id="destination" required>
    <option value="">--Select Destination--</option>
    <option>Austria</option>
    <option>Belgium</option>
    <option>Bulgaria</option>
    <option>Croatia</option>
    <option>Cyprus</option>
    <option>Czech Republic</option>
    <option>Denmark</option>
    <option>Estonia</option>
    <option>Finland</option>
    <option>France</option>
    <option>Germany</option>
    <option>Greece</option>
    <option>Hungary</option>
    <option>Iceland</option>
    <option>Ireland</option>
    <option>Italy</option>
    <option>Latvia</option>
    <option>Lithuania</option>
    <option>Luxembourg</option>
    <option>Malta</option>
    <option>Montenegro</option>
    <option>Netherlands</option>
    <option>North Macedonia</option>
    <option>Norway</option>
    <option>Poland</option>
    <option>Portugal</option>
    <option>Romania</option>
    <option>Serbia</option>
    <option>Slovakia</option>
    <option>Slovenia</option>
    <option>Spain</option>
    <option>Sweden</option>
    <option>Switzerland</option>
    <option>Turkey</option>
    <option>Ukraine</option>
    <option>United Kingdom</option>
    <option>London</option>
  </select>

  <label for="month">Month of Travel:</label>
  <select id="month" required>
    <option value="">--Select Month--</option>
    <option>September</option>
    <option>October</option>
    <option>November</option>
    <option>December</option>
  </select>

  <label for="classYear">Class Year:</label>
  <select id="classYear" required>
    <option value="">--Select Year--</option>
    <option>Freshman</option>
    <option>Sophomore</option>
    <option>Junior</option>
    <option>Senior</option>
  </select>

  <label for="consent">Do you consent to share your email and join Slack?</label>
  <select id="consent" required>
    <option value="">--Select--</option>
    <option>Yes</option>
    <option>No</option>
  </select>

  <button type="submit">Join Travel Pool</button>
</form>

<div class="match-section">
  <button id="showBtn">Show Groups</button>
</div>

<div id="matches"></div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbx6-xuYOXV9X507po4Nn_o9VBNnGBm52MVw5KdHxBqsWKN8b65e5Z8oosXF3AQ6D9cy/exec'; // Replace with your Apps Script URL
const SLACK_INVITE_LINK = "https://travelnyulondon.slack.com/join/shared_invite/zt-3dj3pvgmt-wSBsAkHqHsHR6yr8dHp2gQ#/shared-invite/email";

// Submit form
document.getElementById('travelForm').addEventListener('submit', function(e){
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const destination = document.getElementById('destination').value;
  const month = document.getElementById('month').value;
  const classYear = document.getElementById('classYear').value;
  const consent = document.getElementById('consent').value;

  const formData = new FormData();
  formData.append('name', name);
  formData.append('email', email);
  formData.append('destination', destination);
  formData.append('month', month);
  formData.append('classYear', classYear);
  formData.append('consent', consent);

  fetch(scriptURL, { method: 'POST', body: formData })
    .then(res => res.json())
    .then(data => {
      alert("You have joined the travel pool!");
      if(data.slackLink) alert("Join Slack Workspace: " + data.slackLink);
      document.getElementById('travelForm').reset();
    })
    .catch(err => {
      console.error('Error!', err);
      alert("There was an error submitting the form.");
    });
});

// Show groups
document.getElementById('showBtn').addEventListener('click', function() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      const matchesDiv = document.getElementById('matches');
      matchesDiv.innerHTML = "";

      const destinations = Object.keys(data);
      if(destinations.length === 0) { matchesDiv.innerHTML = "<p>No groups yet.</p>"; return; }

      destinations.forEach(dest => {
        const months = Object.keys(data[dest]);
        months.forEach(month => {
          const classYears = Object.keys(data[dest][month]);
          classYears.forEach(year => {
            const students = data[dest][month][year];
            if(students.length === 0) return;

            const box = document.createElement('div');
            box.className = 'group-box';

            const title = document.createElement('h3');
            title.textContent = `${dest} → ${month} → ${year}`;
            box.appendChild(title);

            // Show Slack link if anyone in this group consented
            if(students.some(s => s.email)) {
              const slackLink = document.createElement('a');
              slackLink.href = SLACK_INVITE_LINK;
              slackLink.target = "_blank";
              slackLink.textContent = "Join Slack Workspace";
              box.appendChild(slackLink);
            }

            const ul = document.createElement('ul');
            students.forEach(s => {
              const li = document.createElement('li');
              li.textContent = `${s.name}${s.email ? " (" + s.email + ")" : ""}`;
              ul.appendChild(li);
            });
            box.appendChild(ul);
            matchesDiv.appendChild(box);
          });
        });
      });
    })
    .catch(err => {
      console.error(err);
      alert("Could not load groups.");
    });
});
</script>

</body>
</html>
