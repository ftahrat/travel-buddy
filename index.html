<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Travel Connections</title>
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(to right, #ffe6f0, #e6f7ff);
      text-align: center;
      padding: 20px;
    }
    h1 { color: #ff3366; margin-bottom: 20px; }
    form, .match-section {
      background-color: #ffffffcc;
      padding: 25px;
      border-radius: 15px;
      display: inline-block;
      margin-bottom: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    input, select, button {
      display: block;
      margin: 12px auto;
      padding: 12px;
      width: 80%;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: linear-gradient(to right, #ff6699, #ff3366);
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    #matches {
      margin-top: 20px;
      font-weight: bold;
      color: #333;
      word-break: break-word;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
      background-color: #fff3f6;
      border-radius: 10px;
      text-align: left;
    }
    #matches li { margin: 8px 0; }
    .group-box {
      margin: 15px 0;
      padding: 10px;
      border-radius: 10px;
      background: #fefefe;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .group-box h3 { margin: 5px 0; color: #ff3366; }
    .group-box a {
      display: inline-block;
      margin-bottom: 8px;
      color: #0073e6;
      text-decoration: underline;
    }
  </style>
</head>
<body>

<h1>Student Travel Connections</h1>

<form id="travelForm">
  <input type="text" id="name" placeholder="Your Name" required>

  <label for="consent">Do you want to share your email and join the chat?</label>
  <select id="consent" required>
    <option value="">--Select an option--</option>
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <input type="email" id="email" placeholder="Your Email">

  <label for="destination">Choose your destination:</label>
  <select id="destination" required>
    <option value="">--Select a destination--</option>
    <option>Austria</option>
    <option>Belgium</option>
    <option>Croatia</option>
    <option>Cyprus</option>
    <option>Czech Republic</option>
    <option>Denmark</option>
    <option>Finland</option>
    <option>France</option>
    <option>Germany</option>
    <option>Greece</option>
    <option>Iceland</option>
    <option>Ireland</option>
    <option>Italy</option>
    <option>Luxembourg</option>
    <option>Montenegro</option>
    <option>Malta</option>
    <option>Albania</option>
    <option>Netherlands</option>
    <option>Norway</option>
    <option>Poland</option>
    <option>Portugal</option>
    <option>Romania</option>
    <option>Serbia</option>
    <option>Spain</option>
    <option>Sweden</option>
    <option>Switzerland</option>
    <option>Turkey</option>
    <option>Georgia</option>
    <option>London</option>
  </select>

  <select id="londonTrips" style="display:none;">
    <option value="">--Select a day trip--</option>
    <option>Stonehenge</option>
    <option>Cambridge</option>
    <option>Oxford</option>
    <option>Bath</option>
    <option>Brighton</option>
    <option>Windsor</option>
  </select>

  <button type="submit">Join Travel Pool</button>
</form>

<div class="match-section">
  <button id="showBtn">Show Groups</button>
</div>

<div id="matches"></div>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzc7_CtGplpTtBU5bQFrcWITmVdoiDYX7NJCzKIJUSNZYyRL8yoUVSzAqkX8hGhsNgS/exec'; // replace with your Web App URL

  // Show London trips only when London is chosen
  document.getElementById('destination').addEventListener('change', function() {
    document.getElementById('londonTrips').style.display = this.value === 'London' ? 'block' : 'none';
  });

  // Handle form submission
  document.getElementById('travelForm').addEventListener('submit', function(e){
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const consent = document.getElementById('consent').value;
    let email = document.getElementById('email').value.trim();
    const destination = document.getElementById('destination').value.trim();
    const dayTrip = document.getElementById('londonTrips').value.trim();

    // Blank out email if consent = No
    if (consent === "No") email = "";

    const formData = new FormData();
    formData.append('name', name);
    formData.append('consent', consent);
    formData.append('email', email);
    formData.append('destination', destination);
    formData.append('dayTrip', dayTrip);

    fetch(scriptURL, { method: 'POST', body: formData })
      .then(res => res.json())
      .then(() => {
        alert("You have joined the travel pool!");
        document.getElementById('travelForm').reset();
        document.getElementById('londonTrips').style.display = 'none';
      })
      .catch(error => {
        console.error('Error!', error.message);
        alert("There was an error submitting the form.");
      });
  });

  // Show groups
  document.getElementById('showBtn').addEventListener('click', function() {
    fetch(scriptURL)
      .then(response => response.json())
      .then(data => {
        const matchesDiv = document.getElementById('matches');
        matchesDiv.innerHTML = "";

        const destinations = Object.keys(data);
        if (destinations.length === 0) {
          matchesDiv.innerHTML = "<p>No groups found yet.</p>";
          return;
        }

        destinations.forEach(dest => {
          const group = data[dest];
          const box = document.createElement('div');
          box.className = 'group-box';

          const title = document.createElement('h3');
          title.textContent = dest;
          box.appendChild(title);

          if (group.groupLink) {
            const link = document.createElement('a');
            link.href = group.groupLink;
            link.target = "_blank";
            link.textContent = "Join Group Chat";
            box.appendChild(link);
          }

          const ul = document.createElement('ul');
          group.students.forEach(student => {
            const emailText = student.email ? ` (${student.email})` : " (Email hidden)";
            const li = document.createElement('li');
            li.textContent = `${student.name}${emailText}${student.dayTrip ? " - " + student.dayTrip : ""}`;
            ul.appendChild(li);
          });
          box.appendChild(ul);

          matchesDiv.appendChild(box);
        });
      })
      .catch(error => {
        console.error('Error fetching data:', error);
        alert("Could not load groups.");
      });
  });
</script>

</body>
</html>
